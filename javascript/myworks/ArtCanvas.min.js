/**
 * ArtCanvas.min.js
 * @fileoverview HTML5 Canvas Library
 *
 * Copyright (c) 2012, 2013, 2014 Tomohiro IKEDA (Korilakkuma)
 * Released under the MIT license
 */
!function(a){"use strict";function b(c,d,e,f,g){this.container=document.body,c instanceof HTMLElement&&(this.container=c),this.container.style.position="relative",this.container.style.top="0px",this.container.style.left="0px",this.container.style.zIndex=1;var h=parseInt(e),i=parseInt(f);this.container.style.width=h>0?h+"px":b.DEFAULT_SIZES.WIDTH+"px",this.container.style.height=i>0?i+"px":b.DEFAULT_SIZES.HEIGHT+"px",this.mode=b.Mode.HAND,this.figure=b.Figure.RECTANGLE,this.textStyle=new b.TextStyle(new b.Font("Arial","16px","normal","normal"),new b.Color(0,0,0,1).toString()),this.transform=b.Transform.TRANSLATE,this.layers=[],this.layers.push(new b.Canvas(this.container,d,e,f,this.layers.length+2)),this.activeLayer=0,this.callbacks={drawstart:function(){},drawmove:function(){},drawend:function(){}},this.setCallbacks(g);var j=null,k=!1,l=this,m=function(a,c,d,e,f){if(/mousedown|touchstart/i.test(f)){var g=a.getCanvas(),h=g.width,i=g.height;return void(j=c.getImageData(0,0,h,i))}var k=a.popPath(),m=k.pop();switch(k.push(m),a.pushPath(k),c.putImageData(j,0,0),l.figure){case b.Figure.RECTANGLE:var n=m.getX(),o=m.getY(),p=b.Point.getOffsetPoint(m,new b.Point(d,e));c.beginPath(),c.rect(n,o,p.getX(),p.getY()),c.stroke(),c.fill(),/mouseup|touchend/i.test(f)&&(a.popPath(),a.pushPath(new b.Rectangle(n,o,p.getX(),p.getY())));break;case b.Figure.CIRCLE:var q=m.getX(),r=m.getY(),s=b.Point.getDistance(m,new b.Point(d,e));c.beginPath(),c.arc(q,r,s,0,2*Math.PI,!1),c.stroke(),c.fill(),/mouseup|touchend/i.test(f)&&(a.popPath(),a.pushPath(new b.Circle(q,r,s,0,2*Math.PI,!1)));break;case b.Figure.LINE:c.beginPath(),c.moveTo(m.getX(),m.getY()),c.lineTo(d,e),c.stroke(),/mouseup|touchend/i.test(f)&&(a.popPath(),a.pushPath(new b.Line(m,new b.Point(d,e))))}},n=function(a,c,d){var e=a.popPath(),f=e.pop(),g=b.Point.getOffsetPoint(f,new b.Point(c,d)),h=[];switch(l.transform){case b.Transform.TRANSLATE:h.push(g.getX()),h.push(g.getY());break;case b.Transform.SCALE:var i=a.getCanvas(),j=1,k=1,m=g.getX(),n=g.getY();0!==m&&(j+=m/i.width),0!==n&&(k+=n/i.height),h.push(j),h.push(k);break;case b.Transform.ROTATE:var o=Math.atan2(g.getY(),g.getX()),p=o/Math.PI*180;h.push(p)}a.transform(l.transform,h),e.push(f),a.pushPath(e)};this.container.addEventListener(b.MouseEvents.START,function(a){if(l.mode!==b.Mode.TOOL){var c=l.layers[l.activeLayer],d=c.getContext();l.mode===b.Mode.ERASER?d.globalCompositeOperation="destination-out":d.globalCompositeOperation="source-over";var e=c.getOffsetX(a),f=c.getOffsetY(a);switch(l.mode){case b.Mode.HAND:case b.Mode.ERASER:d.beginPath(),d.moveTo(e,f);break;case b.Mode.FIGURE:m(c,d,e,f,a.type);break;case b.Mode.TEXT:return void c.createTextbox(new b.Point(e,f));case b.Mode.TRANSFORM:}c.pushPath([new b.Point(e,f)]),k=!0,l.callbacks.drawstart(c,d,e,f)}},!0),this.container.addEventListener(b.MouseEvents.MOVE,function(a){if(k){a.preventDefault();var c=l.layers[l.activeLayer],d=c.getContext(),e=c.getOffsetX(a),f=c.getOffsetY(a);switch(l.mode){case b.Mode.HAND:case b.Mode.ERASER:var g=c.popPath(),h=g.pop();switch(d.beginPath(),d.moveTo(h.getX(),h.getY()),d.lineTo(e,f),d.stroke(),g.push(h),l.mode){case b.Mode.HAND:g.push(new b.Point(e,f));break;case b.Mode.ERASER:g.push(new b.Eraser(new b.Point(e,f)))}c.pushPath(g);break;case b.Mode.TEXT:break;case b.Mode.FIGURE:m(c,d,e,f,a.type);break;case b.Mode.TRANSFORM:n(c,e,f)}l.callbacks.drawmove(c,d,e,f)}},!0),a.addEventListener(b.MouseEvents.END,function(a){if(k){var c=l.layers[l.activeLayer],d=c.getContext(),e=c.getOffsetX(a),f=c.getOffsetY(a);switch(l.mode){case b.Mode.HAND:break;case b.Mode.ERASER:d.globalCompositeOperation="source-over";break;case b.Mode.FIGURE:m(c,d,e,f,a.type),j=null;break;case b.Mode.TEXT:break;case b.Mode.TRANSFORM:c.popPath()}k=!1,c.increaseHistoryPointer(),l.callbacks.drawend(c,d,e,f)}},!0)}b.DEFAULT_SIZES={},b.DEFAULT_SIZES.WIDTH=300,b.DEFAULT_SIZES.HEIGHT=300,b.prototype.getContainerWidth=function(){return parseInt(this.container.style.width)},b.prototype.getContainerHeight=function(){return parseInt(this.container.style.height)},b.prototype.setCallbacks=function(a){if("[object Object]"!==Object.prototype.toString.call(a))return this;for(var b in a)b in this.callbacks&&"[object Function]"===Object.prototype.toString.call(a[b])&&(this.callbacks[b]=a[b]);return this},b.prototype.getMode=function(){return this.mode},b.prototype.setMode=function(a){var c=String(a).toLowerCase();switch(c){case b.Mode.HAND:case b.Mode.FIGURE:case b.Mode.ERASER:case b.Mode.TRANSFORM:case b.Mode.TOOL:this.mode=c;break;case b.Mode.TEXT:this.mode=c,this.addLayer(this.getContainerWidth(),this.getContainerHeight())}var d=this.layers[this.activeLayer];return d.drawText(this.textStyle),this},b.prototype.getActiveLayer=function(){return this.activeLayer},b.prototype.validateLayerNumber=function(a){var b=parseInt(a);return b>=0&&b<this.layers.length},b.prototype.selectLayer=function(a){if(this.validateLayerNumber(a)){var b=parseInt(a);this.activeLayer=b}return this},b.prototype.showLayer=function(a){if(this.validateLayerNumber(a)){var b=parseInt(a),c=this.layers[b],d=c.getCanvas();d.style.visibility="visible"}return this},b.prototype.hideLayer=function(a){if(this.validateLayerNumber(a)){var b=parseInt(a),c=this.layers[b],d=c.getCanvas();d.style.visibility="hidden"}return this},b.prototype.addLayer=function(a,c){return this.layers.push(new b.Canvas(this.container,null,a,c,this.layers.length+2)),this.activeLayer=this.layers.length-1,this},b.prototype.removeLayer=function(a){if(this.layers.length>1&&this.validateLayerNumber(a)){var b=parseInt(a),c=this.layers[b],d=c.getCanvas();this.layers.splice(b,1),d.parentNode.removeChild(d),this.activeLayer>0&&b<=this.activeLayer&&this.activeLayer--}return this},b.prototype.undo=function(){var a=this.layers[this.activeLayer];return a.undo()},b.prototype.redo=function(){var a=this.layers[this.activeLayer];return a.redo()},b.prototype.clear=function(){var a=this.layers[this.activeLayer];return a.clear(),this},b.prototype.getFillStyle=function(){var a=this.layers[this.activeLayer],b=a.getFillStyle();return b},b.prototype.setFillStyle=function(a){var b=this.layers[this.activeLayer];return b.setFillStyle(a),this},b.prototype.getStrokeStyle=function(){var a=this.layers[this.activeLayer],b=a.getStrokeStyle();return b},b.prototype.setStrokeStyle=function(a){var b=this.layers[this.activeLayer];return b.setStrokeStyle(a),this},b.prototype.getLineWidth=function(){var a=this.layers[this.activeLayer],b=a.getLineWidth();return b},b.prototype.setLineWidth=function(a){var b=this.layers[this.activeLayer];return b.setLineWidth(a),this},b.prototype.getLineCap=function(){var a=this.layers[this.activeLayer],b=a.getLineCap();return b},b.prototype.setLineCap=function(a){var b=this.layers[this.activeLayer];return b.setLineCap(a),this},b.prototype.getLineJoin=function(){var a=this.layers[this.activeLayer],b=a.getLineJoin();return b},b.prototype.setLineJoin=function(a){var b=this.layers[this.activeLayer];return b.setLineJoin(a),this},b.prototype.getShadowColor=function(){var a=this.layers[this.activeLayer],b=a.getShadowColor();return b},b.prototype.setShadowColor=function(a){var b=this.layers[this.activeLayer];return b.setShadowColor(a),this},b.prototype.getShadowBlur=function(){var a=this.layers[this.activeLayer],b=a.getShadowBlur();return b},b.prototype.setShadowBlur=function(a){var b=this.layers[this.activeLayer];return b.setShadowBlur(a),this},b.prototype.getShadowOffsetX=function(){var a=this.layers[this.activeLayer],b=a.getShadowOffsetX();return b},b.prototype.setShadowOffsetX=function(a){var b=this.layers[this.activeLayer];return b.setShadowOffsetX(a),this},b.prototype.getShadowOffsetY=function(){var a=this.layers[this.activeLayer],b=a.getShadowOffsetY();return b},b.prototype.setShadowOffsetY=function(a){var b=this.layers[this.activeLayer];return b.setShadowOffsetY(a),this},b.prototype.getGlobalAlpha=function(){var a=this.layers[this.activeLayer],b=a.getGlobalAlpha();return b},b.prototype.setGlobalAlpha=function(a){var b=this.layers[this.activeLayer];return b.setGlobalAlpha(a),this},b.prototype.getTextStyle=function(){return this.textStyle},b.prototype.setTextStyle=function(a){return a instanceof b.TextStyle&&(this.textStyle=a),this},b.prototype.getFigure=function(){return this.figure},b.prototype.setFigure=function(a){var c=String(a).toLowerCase();switch(c){case b.Figure.RECTANGLE:case b.Figure.CIRCLE:case b.Figure.LINE:this.figure=c}return this},b.prototype.getTransform=function(){return this.transform},b.prototype.setTransform=function(a){var c=String(a).toLowerCase();switch(c){case b.Transform.TRANSLATE:case b.Transform.SCALE:case b.Transform.ROTATE:this.transform=c}return this},b.prototype.translate=function(a,c){var d=this.layers[this.activeLayer];return d.transform(b.Transform.TRANSLATE,[a,c]),this},b.prototype.scale=function(a,c){var d=this.layers[this.activeLayer];return d.transform(b.Transform.SCALE,[a,c]),this},b.prototype.rotate=function(a){var c=this.layers[this.activeLayer];return c.transform(b.Transform.ROTATE,[a]),this},b.prototype.drawImage=function(a){var b=this.layers[this.activeLayer];return b.drawImage(a),this},b.prototype.pickColor=function(a){var b=this.layers[this.activeLayer],c=b.pickColor(a);return c},b.prototype.fill=function(a,b){var c=this.layers[this.activeLayer];return c.fill(a,b),this},b.prototype.filter=function(a,b){var c=this.layers[this.activeLayer];return c.filter(a,b),this},b.prototype["export"]=function(a,b){if(!/gif|jpeg|jpg|png/i.test(String(a)))return this;var c=document.createElement("canvas"),d=c.getContext("2d");c.width=this.getContainerWidth(),c.height=this.getContainerHeight();var e=[],f=0,g=this,h=function(){for(var f=0,g=e.length;g>f;f++)d.drawImage(e[f],0,0);"[object Function]"===Object.prototype.toString.call(b)&&b(c.toDataURL("image/"+a.toLowerCase()))},i=function(){if(f>=g.layers.length)return void h();var a=g.layers[f],b=a.getCanvas();if("hidden"===b.style.visibility)return f++,void i();var c=b.toDataURL("image/png"),d=new Image;d.src=c,d.onload=function(){e.push(d),f++,i()}};return i(),this},function(a){function b(){}b.prototype.draw=function(a){},b.prototype.getCenterPoint=function(a){},a.Drawable=b}(b),function(a){function b(){}var c="",d="",e="",f="";/iPhone|iPad|iPod|Android/.test(navigator.userAgent)?(c="click",d="touchstart",e="touchmove",f="touchend"):(c="click",d="mousedown",e="mousemove",f="mouseup"),b.CLICK=c,b.START=d,b.MOVE=e,b.END=f,a.MouseEvents=b}(b),function(a){function b(){}b.HAND="hand",b.FIGURE="figure",b.TEXT="text",b.ERASER="eraser",b.TOOL="tool",b.TRANSFORM="transform",a.Mode=b}(b),function(a){function b(){}b.RECTANGLE="rectangle",b.CIRCLE="circle",b.LINE="line",a.Figure=b}(b),function(a){function b(){}b.TRANSLATE="translate",b.SCALE="scale",b.ROTATE="rotate",a.Transform=b}(b),function(a){function b(){}b.DROPPER="dropper",b.BUCKET="bucket",a.Tool=b}(b),function(a){function b(a,b,c,d){this.red=0,this.green=0,this.blue=0,this.alpha=1;var e=parseInt(a),f=parseInt(b),g=parseInt(c),h=parseFloat(d);!isNaN(e)&&e>=0&&255>=e&&(this.red=e),!isNaN(f)&&f>=0&&255>=f&&(this.green=f),!isNaN(g)&&g>=0&&255>=g&&(this.blue=g),!isNaN(h)&&h>=0&&1>=h&&(this.alpha=h)}b.prototype.getRed=function(){return this.red},b.prototype.getGreen=function(){return this.green},b.prototype.getBlue=function(){return this.blue},b.prototype.getAlpha=function(){return this.alpha},b.prototype.toString=function(){var a="rgba("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")";return a},b.prototype.toHexString=function(){var a="#";return a+=this.red.toString(16)+this.green.toString(16)+this.blue.toString(16)},a.Color=b}(b),function(a){function b(a,b){this.x=0,this.y=0;var c=parseFloat(a),d=parseFloat(b);isNaN(c)||(this.x=c),isNaN(d)||(this.y=d)}b.prototype.getX=function(){return this.x},b.prototype.getY=function(){return this.y},b.getOffsetPoint=function(a,c){var d=0,e=0;return a instanceof b&&c instanceof b&&(d=c.getX()-a.getX(),e=c.getY()-a.getY()),new b(d,e)},b.getDistance=function(a,c){var d=b.getOffsetPoint(a,c);return Math.sqrt(Math.pow(d.getX(),2)+Math.pow(d.getY(),2))},a.Point=b}(b),function(a){function b(b,c,d,e){a.Drawable.call(this),this.left=0,this.top=0,this.width=0,this.height=0;var f=parseFloat(b),g=parseFloat(c),h=parseFloat(d),i=parseFloat(e);isNaN(f)||(this.left=f),isNaN(g)||(this.top=g),h>0&&(this.width=h),i>0&&(this.height=i)}b.prototype=Object.create(a.Drawable.prototype),b.prototype.constructor=b,b.prototype.getLeft=function(){return this.left},b.prototype.getTop=function(){return this.top},b.prototype.getRight=function(){return this.left+this.width},b.prototype.getBottom=function(){return this.top+this.height},b.prototype.getLeftTop=function(){return{left:this.left,top:this.top}},b.prototype.getRightBottom=function(){return{right:this.left+this.width,bottom:this.top+this.height}},b.prototype.getWidth=function(){return this.width},b.prototype.getHeight=function(){return this.height},b.prototype.getSize=function(){return{width:this.width,height:this.height}},b.prototype.draw=function(a){a.beginPath(),a.rect(this.left,this.top,this.width,this.height),a.stroke(),a.fill()},b.prototype.getCenterPoint=function(b){var c=this.width/2+this.left,d=this.height/2+this.top;return new a.Point(c,d)},a.Rectangle=b}(b),function(a){function b(b,c,d){a.Drawable.call(this),this.centerX=0,this.centerY=0,this.radius=0;var e=parseFloat(b),f=parseFloat(c),g=parseFloat(d);isNaN(e)||(this.centerX=e),isNaN(f)||(this.centerY=f),g>0&&(this.radius=g)}b.prototype=Object.create(a.Drawable.prototype),b.prototype.constructor=b,b.prototype.getCenterX=function(){return this.centerX},b.prototype.getCenterY=function(){return this.centerY},b.prototype.getCenter=function(){return{x:this.centerX,y:this.centerY}},b.prototype.getRadius=function(){return this.radius},b.prototype.draw=function(a){a.beginPath(),a.arc(this.centerX,this.centerY,this.radius,0,2*Math.PI,!1),a.stroke(),a.fill()},b.prototype.getCenterPoint=function(b){return new a.Point(this.centerX,this.centerY)},a.Circle=b}(b),function(a){function b(b,c){a.Drawable.call(this),this.startPoint=new a.Point(0,0),this.endPoint=new a.Point(0,0),b instanceof a.Point&&(this.startPoint=b),c instanceof a.Point&&(this.endPoint=c)}b.prototype=Object.create(a.Drawable.prototype),b.prototype.constructor=b,b.prototype.getStartPoint=function(){return this.startPoint},b.prototype.getEndPoint=function(){return this.endPoint},b.prototype.draw=function(a){a.beginPath(),a.moveTo(this.startPoint.getX(),this.startPoint.getY()),a.lineTo(this.endPoint.getX(),this.endPoint.getY()),a.stroke()},b.prototype.getCenterPoint=function(b){var c=Math.min(this.startPoint.getX(),this.endPoint.getX()),d=Math.min(this.startPoint.getY(),this.endPoint.getY()),e=Math.max(this.startPoint.getX(),this.endPoint.getX()),f=Math.max(this.startPoint.getY(),this.endPoint.getY()),g=(e-c)/2+c,h=(f-d)/2+d;return new a.Point(g,h)},a.Line=b}(b),function(a){function b(b,c,d){a.Drawable.call(this),this.text=String(b),this.point=new a.Point(0,0),this.textStyle=null,c instanceof a.Point&&(this.point=c),d instanceof a.TextStyle&&(this.textStyle=d)}function c(b,c){this.font=null,this.color=String(c),b instanceof a.Font&&(this.font=b)}function d(a,b,c,d){this.family=String(a),this.size=String(b),this.style=String(c),this.weight=String(d)}b.prototype=Object.create(a.Drawable.prototype),b.prototype.constructor=b,b.prototype.getText=function(){return this.text},b.prototype.getPoint=function(){return this.point},b.prototype.getTextStyle=function(){return this.textStyle},b.prototype.draw=function(a){var b=this.textStyle.getFont(),c=this.textStyle.getColor(),d=a.fillStyle;a.font=b.getFontString(),a.fillStyle=c,a.fillText(this.text,this.point.getX(),this.point.getY()),a.fillStyle=d},b.prototype.getCenterPoint=function(b){var c=this.textStyle.getFont(),d=parseInt(c.getSize()),e=this.point.getX()+b.measureText(this.text).width/2,f=this.point.getY()+d/2;return new a.Point(e,f)},c.prototype.getFont=function(){return this.font},c.prototype.getColor=function(){return this.color},d.prototype.getFamily=function(){return this.family},d.prototype.getSize=function(){return this.size},d.prototype.getStyle=function(){return this.style},d.prototype.getWeight=function(){return this.weight},d.prototype.getFontString=function(){return this.style+" "+this.weight+" "+this.size+' "'+this.family+'"'},d.prototype.toString=function(){return this.getFontString()},a.Text=b,a.TextStyle=c,a.Font=d}(b),function(a){function b(b,c){a.Drawable.call(this),this.image=new Image,this.image.src=b,this.image.onload=c}b.prototype=Object.create(Image.prototype),b.prototype=Object.create(a.Drawable.prototype),b.prototype.constructor=b,b.prototype.draw=function(a){a.drawImage(this.image,0,0)},b.prototype.getCenterPoint=function(b){var c=this.image.width/2,d=this.image.height/2;return new a.Point(c,d)},a.DrawableImage=b}(b),function(a){function b(b){this.point=new a.Point(0,0),b instanceof a.Point&&(this.point=b)}b.prototype.getPoint=function(){return this.point},b.prototype.getX=function(){return this.point.getX()},b.prototype.getY=function(){return this.point.getY()},a.Eraser=b}(b),function(a){function b(a,c){this.type=b.NONE,String(a).toUpperCase()in b&&(this.type=String(a).toLowerCase()),this.amounts=[],Array.isArray(c)&&(this.amounts=c)}b.NONE="none",b.REDEMPHASIS="redemphasis",b.GRAYSCALE="grayscale",b.REVERSE="reverse",b.NOISE="noise",b.BLUR="blur",b.prototype.getType=function(){return this.type},b.prototype.getAmounts=function(){return this.amounts},b.prototype.none=function(a){return a},b.prototype.redemphasis=function(a,b){for(var c=0,d=a.data.length;d>c;c++)switch(c%4){case 0:b.data[c]=Math.floor(1.5*a.data[c]);break;case 1:b.data[c]=Math.floor(0*a.data[c]);break;case 2:b.data[c]=Math.floor(1*a.data[c]);break;case 3:b.data[c]=Math.floor(1*a.data[c])}return b},b.prototype.grayscale=function(a,b){for(var c=0,d=a.data.length;d>c;c+=4){var e=Math.floor((a.data[c]+a.data[c+1]+a.data[c+2])/3);b.data[c]=b.data[c+1]=b.data[c+2]=e,b.data[c+3]=a.data[c+3]}return b},b.prototype.reverse=function(a,b){for(var c=0,d=a.data.length;d>c;c+=4)b.data[c+0]=255-a.data[c+0],b.data[c+1]=255-a.data[c+1],b.data[c+2]=255-a.data[c+2],b.data[c+3]=a.data[c+3];return b},b.prototype.noise=function(a,b){if(!Array.isArray(this.amounts)||this.amounts.length<3)return a;var c=parseInt(this.amounts[0]);if(isNaN(c)||0>c)return a;var d=parseInt(this.amounts[1]);if(isNaN(d)||0>d)return a;var e=parseInt(this.amounts[2]);if(isNaN(e)||0>e)return a;for(var f=0;e>f;f++){var g=Math.random()*c,h=Math.random()*d,i=Math.floor(4*(h*c+g)),j=a.data[i+0]>>1,k=a.data[i+1]>>2,l=a.data[i+2]>>1;b.data[i+0]=j,b.data[i+1]=k,b.data[i+2]=l,b.data[i+3]=a.data[i+3]}return b},b.prototype.blur=function(a,b){if(!Array.isArray(this.amounts)||this.amounts.length<1)return a;var c=9,d=new Array(c),e=0,f=0,g=parseInt(this.amounts[0]);if(isNaN(g)||0>g)return a;for(var h=0,i=a.data.length;i>h;h++){d=[h-4-4*g,h-4*g,h+4-4*g,h-4,h,h+4,h-4+4*g,h+4*g,h+4+4*g],e=0,f=0;for(var j=0;c>j;j++)d[j]>=0&&d[j]<a.data.length&&(e+=a.data[d[j]],f++);b.data[h]=Math.floor(e/f)}return b},b.prototype.filter=function(b){if(!(b instanceof a.Canvas))return this;var c=b.getContext(),d=b.getCanvas(),e=c.getImageData(0,0,d.width,d.height),f=c.createImageData(d.width,d.height);return c.putImageData(this[this.type](e,f),0,0),this},a.Filter=b}(b),function(a){function b(b,c,d,e,f){this.container=document.body,this.canvas=null,this.context=null,b instanceof HTMLElement&&(this.container=b),c instanceof HTMLCanvasElement?this.canvas=c:(this.canvas=document.createElement("canvas"),this.container.appendChild(this.canvas)),this.context=this.canvas.getContext("2d");var g=parseInt(d),h=parseInt(e);this.canvas.setAttribute("width",g>0?g:a.DEFAULT_SIZES.WIDTH),this.canvas.setAttribute("height",h>0?h:a.DEFAULT_SIZES.HEIGHT),this.clear(),this.canvas.style.position="absolute",this.canvas.style.top="0px",this.canvas.style.left="0px",this.canvas.style.zIndex=f,this.context.strokeStyle=new a.Color(0,0,0,1).toString(),this.context.fillStyle=new a.Color(0,0,0,1).toString(),this.context.globalAlpha=1,this.context.lineWidth=1,this.context.lineCap="butt",this.context.lineJoin="miter",this.paths=[],this.historyPointer=0,this.transforms={translate:{x:0,y:0},scale:{x:1,y:1},skew:{x:0,y:0},rotate:0}}b.prototype.getCanvas=function(){return this.canvas},b.prototype.getContext=function(){return this.context},b.prototype.getPaths=function(){return this.paths},b.prototype.pushPath=function(a){return this.paths[this.historyPointer]=a,this},b.prototype.popPath=function(){return this.paths[this.historyPointer]},b.prototype.getHistoryPointer=function(){return this.historyPointer},b.prototype.increaseHistoryPointer=function(){return this.historyPointer++,this.historyPointer<this.paths.length&&(this.paths=this.paths.slice(0,this.historyPointer)),this},b.prototype.draw=function(b){b&&this.transform();for(var c=0;c<this.historyPointer;c++){var d=this.paths[c];if(Array.isArray(d))for(var e=0,f=d.length;f>e;e++){var g=d[e],h=g.getX(),i=g.getY();g instanceof a.Eraser&&(this.context.globalCompositeOperation="destination-out"),0===e?(this.context.beginPath(),this.context.moveTo(h,i)):(this.context.lineTo(h,i),this.context.stroke()),g instanceof a.Eraser&&(this.context.globalCompositeOperation="source-over")}else d instanceof a.Filter?d.filter(this):d.draw(this.context)}return this},b.prototype.drawText=function(b){if(!(b instanceof a.TextStyle))return"";var c=this.container.querySelector('[type="text"]');if(!(c instanceof HTMLInputElement))return"";var d=b.getFont(),e=b.getColor(),f=parseInt(d.getSize()),g=c.value,h=parseInt(c.style.left),i=parseInt(c.style.top)+f;this.container.removeChild(c);var j=this.context.fillStyle;return this.context.font=d.getFontString(),this.context.fillStyle=e,this.context.fillText(g,h,i),this.context.fillStyle=j,this.paths.push(new a.Text(g,new a.Point(h,i),b)),this.increaseHistoryPointer(),g},b.prototype.drawImage=function(b){var c=this,d=new a.DrawableImage(String(b),function(){c.context.drawImage(this,0,0),c.paths.push(d),c.historyPointer++});return this},b.prototype.transform=function(b,c){Array.isArray(c)||(c=[c]);var d=this.getCenterPoint();if(null!==d){var e=d.getX(),f=d.getY(),g=this.transforms,h=g.translate,i=g.scale;g.skew;switch(String(b).toLowerCase()){case a.Transform.TRANSLATE:if(c.length<2)break;var j=parseFloat(c[0]),k=parseFloat(c[1]);if(isNaN(j)||isNaN(k))break;h.x=j,h.y=k;break;case a.Transform.SCALE:if(c.length<2)break;var l=parseFloat(c[0]),m=parseFloat(c[1]);if(isNaN(l)||isNaN(m))break;i.x=l,i.y=m;break;case a.Transform.ROTATE:if(c.length<1)break;var n=parseFloat(c[0]);if(isNaN(n))break;g.rotate=n*Math.PI/180}var o=g.rotate,p=[Math.cos(o),Math.sin(o),-Math.sin(o),Math.cos(o),0,0];switch(this.clear(),this.context.save(),String(b).toLowerCase()){case a.Transform.TRANSLATE:case a.Transform.SCALE:this.context.setTransform(1,0,0,1,0,0),this.context.transform(1,0,0,1,e,f),this.context.transform.apply(this.context,p),this.context.transform(1,0,0,1,-e,-f),this.context.transform(i.x,0,0,i.y,h.x,h.y);break;case a.Transform.ROTATE:this.context.setTransform(1,0,0,1,0,0),this.context.transform(i.x,0,0,i.y,h.x,h.y),this.context.transform(1,0,0,1,e,f),this.context.transform.apply(this.context,p),this.context.transform(1,0,0,1,-e,-f)}return arguments.length>1&&(this.draw(!1),this.context.restore()),this}},b.prototype.clear=function(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this},b.prototype.clearPaths=function(){return this.paths.length=0,this},b.prototype.undo=function(){return this.historyPointer>0?(this.historyPointer--,this.clear(),this.draw(!0),!0):!1},b.prototype.redo=function(){return this.historyPointer<this.paths.length?(this.historyPointer++,this.clear(),this.draw(!0),!0):!1},b.prototype.getFillStyle=function(){return this.context.fillStyle},b.prototype.setFillStyle=function(a){return this.context.fillStyle=String(a),this.draw(!0),this},b.prototype.getStrokeStyle=function(){return this.context.strokeStyle},b.prototype.setStrokeStyle=function(a){return this.context.strokeStyle=String(a),this.draw(!0),this},b.prototype.getLineWidth=function(){return this.context.lineWidth},b.prototype.setLineWidth=function(a){var b=parseFloat(a);return b>0&&(this.context.lineWidth=b,this.draw(!0)),this},b.prototype.getLineCap=function(){return this.context.lineCap},b.prototype.setLineCap=function(a){return/butt|round|square/i.test(String(a))?(this.context.lineCap=a.toLowerCase(),this.draw(!0),this):this},b.prototype.getLineJoin=function(){return this.context.lineJoin},b.prototype.setLineJoin=function(a){return/bevel|round|miter/i.test(String(a))?(this.context.lineJoin=a.toLowerCase(),this.draw(!0),this):this},b.prototype.getShadowColor=function(){return this.context.shadowColor},b.prototype.setShadowColor=function(a){return this.context.shadowColor=String(a),this.draw(!0),this},b.prototype.getShadowBlur=function(){return this.context.shadowBlur},b.prototype.setShadowBlur=function(a){var b=parseFloat(a);return b>=0&&(this.context.shadowBlur=b,this.draw(!0)),this},b.prototype.getShadowOffsetX=function(){return this.context.shadowOffsetX},b.prototype.setShadowOffsetX=function(a){var b=parseFloat(a);return isNaN(b)||(this.context.shadowOffsetX=b,this.draw(!0)),this},b.prototype.getShadowOffsetY=function(){return this.context.shadowOffsetY},b.prototype.setShadowOffsetY=function(a){var b=parseFloat(a);return isNaN(b)||(this.context.shadowOffsetY=b,this.draw(!0)),this},b.prototype.getGlobalAlpha=function(){return this.context.globalAlpha},b.prototype.setGlobalAlpha=function(a){var b=parseFloat(a);return b>=0&&1>=b&&(this.context.globalAlpha=b,this.draw(!0)),this},b.prototype.getOffsetX=function(a){if(!(a instanceof Event))return 0;a.pageX||(a.touches[0]?a=a.touches[0]:a.changedTouches[0]&&(a=a.changedTouches[0]));var b=this.container.scrollLeft,c=a.pageX-this.container.offsetLeft+b,d=this.canvas.width;return 0>c&&(c=0),c>d&&(c=d),c},b.prototype.getOffsetY=function(a){if(!(a instanceof Event))return 0;a.pageY||(a.touches[0]?a=a.touches[0]:a.changedTouches[0]&&(a=a.changedTouches[0]));var b=this.container.scrollTop,c=a.pageY-this.container.offsetTop+b,d=this.canvas.height;return 0>c&&(c=0),c>d&&(c=d),c},b.prototype.getCenterPoint=function(){for(var b=null,c=0;c<this.historyPointer;c++){var d=this.paths[c];if(Array.isArray(d)){for(var e=Number.MAX_VALUE,f=Number.MAX_VALUE,g=0,h=0,i=0,j=d.length;j>i;i++){var k=d[i],l=k.getX(),m=k.getY();e>l&&(e=l),f>m&&(f=m),l>g&&(g=l),m>h&&(h=m)}var n=Math.floor((g-e)/2+e),o=Math.floor((h-f)/2+f);b=new a.Point(n,o)}else d instanceof a.Drawable&&(b=d.getCenterPoint(this.context))}return b},b.prototype.createTextbox=function(b){if(!(b instanceof a.Point))return this;if(this.container.querySelector('[type="text"]')instanceof HTMLInputElement)return this;var c=b.getX(),d=b.getY(),e=document.createElement("input");return e.setAttribute("type","text"),e.style.position="absolute",e.style.top=d+"px",e.style.left=c+"px",e.style.zIndex=parseInt(this.canvas.style.zIndex)+1,e.style.outline="none",e.style.padding="0.5em",this.container.appendChild(e),e},b.prototype.pickColor=function(b){if(!(b instanceof Event))return new a.Color(0,0,0,1);var c=this.context.getImageData(this.getOffsetX(b),this.getOffsetY(b),1,1),d=new a.Color(c.data[0],c.data[1],c.data[2],c.data[3]/255);return d},b.prototype.fill=function(b,c){if(b instanceof Event&&c instanceof a.Color){var d=this.canvas.width,e=this.canvas.height,f=this.context.getImageData(0,0,d,e),g=this.getOffsetX(b),h=this.getOffsetY(b),i=function(a,b){return 4*(d*b+a)},j=function(a,b,c){a.data[b]=c.getRed(),a.data[b+1]=c.getGreen(),a.data[b+2]=c.getBlue(),a.data[b+3]=255*c.getAlpha()},k=function(a,b,c){var d=i(a,b);return f.data[d]!==c.getRed()?!1:f.data[d+1]!==c.getGreen()?!1:f.data[d+2]!==c.getBlue()?!1:f.data[d+3]!==c.getAlpha()?!1:!0},l=function(a,b,d){for(var e=a;b>=e;e++){var g=i(e,d);j(f,g,c)}},m=function(a,b,c,d,e){for(;b>=a;){for(;b>=a&&!k(a,c,e);)a++;if(a>b)break;for(;b>=a&&k(a,c,e);)a++;d.push({x:a-1,y:c})}},n=i(g,h),o=new a.Color(f.data[n],f.data[n+1],f.data[n+2],f.data[n+3]);if(k(g,h,c))return void this.context.putImageData(f,0,0);var p=[];for(p.push({x:g,y:h});p.length>0;){var q=p.pop(),r=q.x,s=q.x;if(!k(q.x,q.y,c)){for(;r>0&&k(r-1,q.y,o);)r--;for(;s<this.canvas.width-1&&k(s+1,q.y,o);)s++;l(r,s,q.y),q.y+1<e&&m(r,s,q.y+1,p,o),q.y-1>=0&&m(r,s,q.y-1,p,o)}}return this.context.putImageData(f,0,0),this}},b.prototype.filter=function(b,c){var d=new a.Filter(b,c);return d.filter(this),this.paths.push(d),this.increaseHistoryPointer(),this},a.Canvas=b}(b),a.ArtCanvas=b}(window);
//# sourceMappingURL=ArtCanvas.js.map